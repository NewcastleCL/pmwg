<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Particle Based Samplers for MCMC • psamplers</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Particle Based Samplers for MCMC">
<meta property="og:description" content=" Particle Based Sampler for MCMC ">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">psamplers</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.0.9025</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/PMwG.html">Particle Based Samplers for MCMC</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/gjcooper/psamplers/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Particle Based Samplers for MCMC</h1>
                        <h4 class="author">Jon-Paul Cavallaro</h4>
            
      
      <small class="dont-index">Source: <a href="https://github.com/gjcooper/psamplers/blob/master/vignettes/PMwG.Rmd"><code>vignettes/PMwG.Rmd</code></a></small>
      <div class="hidden name"><code>PMwG.Rmd</code></div>

    </div>

    
    
<p>This vignette is taken from the bookdown documentation that can be found at: <a href="https://newcastlecl.github.io/samplerDoc/" class="uri">https://newcastlecl.github.io/samplerDoc/</a>. In particular this is verbatim from Chapter 3 (<a href="https://newcastlecl.github.io/samplerDoc/example-2-forstmann-et-al-2008-dataset.html">Example 2</a>). For more detail on the methods and usecases of the package please refer to the full bookdown resource.</p>
<div id="example-2---forstmann-et-al--2008-dataset" class="section level1">
<h1 class="hasAnchor">
<a href="#example-2---forstmann-et-al--2008-dataset" class="anchor"></a>Example 2 - Forstmann et al. (2008) dataset</h1>
<p>We begin with a simple use case of the psamplers package with data from <span class="citation">Forstmann et al. (<a href="#ref-forstmann2008striatum">2008</a>)</span>.</p>
<div id="description-of-forstmann-experiment" class="section level2">
<h2 class="hasAnchor">
<a href="#description-of-forstmann-experiment" class="anchor"></a>Description of Forstmann experiment</h2>
<p>First we need to install the psamplers package. We currently recommended installing psamplers via devtools.</p>
<div class="sourceCode"><html><body><pre class="r"># The samplers package will be on CRAN - this step will be removed.
install_github('newcastlecl\samplers')</pre></body></html></div>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">psamplers</span>)</pre></body></html></div>
<p>Forstmann et al looked at neural correlates of decision making under time pressure, with an aim to identify areas of the brain associated with speed-accuracy tradeoff. Imaging (fMRI) and behavioural data was collected; however, we will analyse behavioural data from the decision-making task only. In terms of modelling the data, Forstmann expected to find differences in thresholds (direction?) for each of the three speed-emphasis conditions. We have included the Forstmann et als data in the psamplers package as a data frame object named <code>forstmann</code>. The sampler requires a data frame with a <b><code>subject</code></b> column. The subject column data type can be a factor or numeric.</p>
<p>Table @ref(tab:forsthead10) shows the first ten trials from the Forstmann dataset. Participants <code>(n = 19)</code> were asked to indicate whether a cloud of dots in a random-dot kinematogram (RDK) moved to the left or the right of the screen. The IV was a within-subject, speed-accuracy manipulation where, before each trial began, pariticipants were instructed to make their choice <i>accurately</i> <code>(condition = 1)</code>, with <i>urgency</i><code>(condition = 3)</code>or were presented with a <i>neutral</i> message <code>(condition = 2)</code>. Choice and response time data was collected. Choices were coded as correct <code>(correct = 2)</code> or incorrect <code>(correct =  1)</code> and response times <code>(rt)</code> were recorded in seconds. For more information about the design of the experiment please see <a href="https://www.pnas.org/content/105/45/17538.short">the original paper</a>.</p>
<table class="table">
<caption>First 10 trials in Forstmann dataset. The <code>forstmann</code> dataset is an object/data frame</caption>
<thead><tr class="header">
<th align="right">subject</th>
<th align="right">rt</th>
<th align="right">correct</th>
<th align="right">condition</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.4319</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">0.5015</td>
<td align="right">2</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.3104</td>
<td align="right">2</td>
<td align="right">3</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">0.4809</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.3415</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">0.3465</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.3572</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">0.4042</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr class="odd">
<td align="right">1</td>
<td align="right">0.3866</td>
<td align="right">2</td>
<td align="right">2</td>
</tr>
<tr class="even">
<td align="right">1</td>
<td align="right">0.3683</td>
<td align="right">2</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
</div>
<div id="setting-up-the-sampler" class="section level2">
<h2 class="hasAnchor">
<a href="#setting-up-the-sampler" class="anchor"></a>Setting up the sampler</h2>
<p>We will use the Linear Ballistic Accumulator (LBA) <span class="citation">(Brown and Heathcote <a href="#ref-brown2008simplest">2008</a>)</span> to demonstrate how to use the psamplers package. The LBA model parameters are:</p>
<ul>
<li>
<code>b</code> threshold parameter (the evidence required to make a response)</li>
<li>
<code>v</code> is drift rate or average speed of evidence accumulation</li>
<li>
<code>A</code> is the model’s start point</li>
<li>
<code>t0</code> is non-decision time.</li>
<li><b>Do we need to mention <code>sv</code> here? </b></li>
</ul>
<p>We begin by creating a vector of parameter names for the model. You can name this object as you wish; however, in our example, we will call it <code>pars</code>. The parameters you list in the <code>pars</code> vector must match the names and number of parameters you include in your likelihood function.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">pars</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"b1"</span>, <span class="st">"b2"</span>, <span class="st">"b3"</span>, <span class="st">"A"</span>, <span class="st">"v1"</span>, <span class="st">"v2"</span>, <span class="st">"t0"</span>)</pre></body></html></div>
<p>For this dataset, we use three threshold parameters (<code>b1</code>, <code>b2</code>, and <code>b3</code> i.e. one for each condition) because we assume that the participant responds to each condition with a different level of caution. We include two drift rate parameters: <code>v1</code> for the incorrect accumulator and <code>v2</code> for the correct accumulator, a start point parameter <code>A</code> and a non-decision time <code>t0</code> parameter. We’ve made a decision to set the <code>sv</code> to 1 to satisfy the scaling properties of the model, as such we haven’t included the <code>sv</code> parameter in the <code>pars</code> vector - it is found in the LBA’s likelihood function (see below).</p>
<p>Next we create a <code>priors</code> object; a list that contains two components</p>
<ul>
<li>
<code>theta_mu</code> a vector containing the prior for model parameter means</li>
<li>
<code>theta_sig</code> the prior covariance matrix for model parameters.</li>
</ul>
<div class="sourceCode"><html><body><pre class="r"><span class="no">priors</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="kw">theta_mu</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">pars</span>)),
  <span class="kw">theta_sig</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">1</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">pars</span>)))
)</pre></body></html></div>
<p>The <code>priors</code> object in our example is initiated with zeros. <b>Under what conditions would this priors object differ?</b></p>
<p>The next step is to include your log likelihood function. This must be called before you create the sampler object in the following step. You can load your log likelihood function from an external script:</p>
<div class="sourceCode"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/source.html">source</a></span>(<span class="kw">file</span> <span class="kw">=</span> <span class="st">"yourLogLikelihoodFile.R"</span>)</pre></body></html></div>
<p>Or you can write a log likelihood function as we have done with the LBA log likelihood function below. If you’d like to run through this example, it is best to copy the <code>lba_loglike</code> function from the code block below rather than copying from the following separate code chunks, as some curly braces have been removed from code chunks.</p>
<div class="sourceCode"><table class="table sourceCode r numberLines"><tr class="sourceCode">
<td class="lineNumbers"><pre>1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td>
<td class="sourceCode"><pre><code class="sourceCode r">lba_loglike &lt;-<span class="st"> </span><span class="cf">function</span>(x, data, <span class="dt">sample =</span> <span class="ot">FALSE</span>) {
  x &lt;-<span class="st"> </span><span class="kw">exp</span>(x)
  <span class="cf">if</span> (<span class="kw">any</span>(data<span class="op">$</span>rt <span class="op">&lt;</span><span class="st"> </span>x[<span class="st">"t0"</span>])) {
    <span class="kw">return</span>(<span class="op">-</span><span class="fl">1e10</span>)
  }

  bs &lt;-<span class="st"> </span>x[<span class="st">"A"</span>] <span class="op">+</span><span class="st"> </span>x[<span class="kw">c</span>(<span class="st">"b1"</span>, <span class="st">"b2"</span>, <span class="st">"b3"</span>)][data<span class="op">$</span>condition]

  <span class="cf">if</span> (sample) {
    out &lt;-<span class="st"> </span>rtdists<span class="op">::</span><span class="kw">rLBA</span>(<span class="dt">n =</span> <span class="kw">nrow</span>(data),
                         <span class="dt">A =</span> x[<span class="st">"A"</span>],
                         <span class="dt">b =</span> bs,
                         <span class="dt">t0 =</span> x[<span class="st">"t0"</span>],
                         <span class="dt">mean_v =</span> x[<span class="kw">c</span>(<span class="st">"v1"</span>, <span class="st">"v2"</span>)],
                         <span class="dt">sd_v =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),
                         <span class="dt">distribution =</span> <span class="st">"norm"</span>,
                         <span class="dt">silent =</span> <span class="ot">TRUE</span>)
  } <span class="cf">else</span> {
    out &lt;-<span class="st"> </span>rtdists<span class="op">::</span><span class="kw">dLBA</span>(<span class="dt">rt =</span> data<span class="op">$</span>rt,
                         <span class="dt">response =</span> data<span class="op">$</span>correct,
                         <span class="dt">A =</span> x[<span class="st">"A"</span>],
                         <span class="dt">b =</span> bs,
                         <span class="dt">t0 =</span> x[<span class="st">"t0"</span>],
                         <span class="dt">mean_v =</span> x[<span class="kw">c</span>(<span class="st">"v1"</span>, <span class="st">"v2"</span>)],
                         <span class="dt">sd_v =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),
                         <span class="dt">distribution =</span> <span class="st">"norm"</span>,
                         <span class="dt">silent =</span> <span class="ot">TRUE</span>)
    bad &lt;-<span class="st"> </span>(out <span class="op">&lt;</span><span class="st"> </span><span class="fl">1e-10</span>) <span class="op">|</span><span class="st"> </span>(<span class="op">!</span><span class="kw">is.finite</span>(out))
    out[bad] &lt;-<span class="st"> </span><span class="fl">1e-10</span>
    out &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">log</span>(out))
  }
  out
}</code></pre></td>
</tr></table></div>
<p>The <code>lba_loglike</code> function takes three arguments:</p>
<ul>
<li>
<code>x</code> is a named parameter vector (e.g. <code>pars</code>)</li>
<li>
<code>data</code> is your data set (e.g.<code>forstmann</code>)</li>
<li>
<code>sample =</code> default is <code>FALSE</code> calculates a density function or set to <code>TRUE</code> to generate a sample that matches the shape of data.</li>
</ul>
<p>The first line in the <code>lba_loglike</code> function (Line 2 below) takes the exponent of the parameter values to move all parameter values to the real line. <b>The purpose of this is to….. </b> Line 3 and 4 then checks RTs are faster than the non-decision time parameter, and zero those RTs that are faster than non-decision time.</p>
<div class="sourceCode"><table class="table sourceCode r numberLines"><tr class="sourceCode">
<td class="lineNumbers"><pre>1
2
3
4
5
</pre></td>
<td class="sourceCode"><pre><code class="sourceCode r">lba_loglike &lt;-<span class="st"> </span><span class="cf">function</span>(x, data, <span class="dt">sample =</span> <span class="ot">FALSE</span>) {
  x &lt;-<span class="st"> </span><span class="kw">exp</span>(x) 
  <span class="cf">if</span> (<span class="kw">any</span>(data<span class="op">$</span>rt <span class="op">&lt;</span><span class="st"> </span>x[<span class="st">"t0"</span>])) {
    <span class="kw">return</span>(<span class="op">-</span><span class="fl">1e10</span>)
  }</code></pre></td>
</tr></table></div>
<p>Next (Line 7) we create a vector containing threshold parameters for each row in the data set that takes into account the condition and adds the start point value. We add the start point parameter <code>A</code> value to each threshold parameter so that threshold is greater than the start point value.</p>
<div class="sourceCode" startfrom="7"><table class="table sourceCode r numberLines"><tr class="sourceCode">
<td class="lineNumbers"><pre>7
</pre></td>
<td class="sourceCode"><pre><code class="sourceCode r">  bs &lt;-<span class="st"> </span>x[<span class="st">"A"</span>] <span class="op">+</span><span class="st"> </span>x[<span class="kw">c</span>(<span class="st">"b1"</span>, <span class="st">"b2"</span>, <span class="st">"b3"</span>)][data<span class="op">$</span>condition]</code></pre></td>
</tr></table></div>
<p>The <code>if else</code> statement below (Line 9-32) does one of two things: <code>if (sample)</code> calculates the posterior predictive data and the <code>else</code> statement calculates the density function. Toward the end of the <code>else</code> statment (line 28) we take all implausible likelihood values, assign them to the <code>bad</code> object and set them to zero. The final line in the <code>else</code> statement takes the log of all likelihood values, sums them and then assigns the model’s log likelihood value to the <code>out</code> variable.</p>
<div class="sourceCode" startfrom="9"><table class="table sourceCode r numberLines"><tr class="sourceCode">
<td class="lineNumbers"><pre>9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
</pre></td>
<td class="sourceCode"><pre><code class="sourceCode r">  <span class="cf">if</span> (sample) {
    out &lt;-<span class="st"> </span>rtdists<span class="op">::</span><span class="kw">rLBA</span>(<span class="dt">n =</span> <span class="kw">nrow</span>(data),
                         <span class="dt">A =</span> x[<span class="st">"A"</span>],
                         <span class="dt">b =</span> bs,
                         <span class="dt">t0 =</span> x[<span class="st">"t0"</span>],
                         <span class="dt">mean_v =</span> x[<span class="kw">c</span>(<span class="st">"v1"</span>, <span class="st">"v2"</span>)],
                         <span class="dt">sd_v =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),
                         <span class="dt">distribution =</span> <span class="st">"norm"</span>,
                         <span class="dt">silent =</span> <span class="ot">TRUE</span>)
  } <span class="cf">else</span> {
    out &lt;-<span class="st"> </span>rtdists<span class="op">::</span><span class="kw">dLBA</span>(<span class="dt">rt =</span> data<span class="op">$</span>rt,
                         <span class="dt">response =</span> data<span class="op">$</span>correct,
                         <span class="dt">A =</span> x[<span class="st">"A"</span>],
                         <span class="dt">b =</span> bs,
                         <span class="dt">t0 =</span> x[<span class="st">"t0"</span>],
                         <span class="dt">mean_v =</span> x[<span class="kw">c</span>(<span class="st">"v1"</span>, <span class="st">"v2"</span>)],
                         <span class="dt">sd_v =</span> <span class="kw">c</span>(<span class="dv">1</span>, <span class="dv">1</span>),
                         <span class="dt">distribution =</span> <span class="st">"norm"</span>,
                         <span class="dt">silent =</span> <span class="ot">TRUE</span>)
    bad &lt;-<span class="st"> </span>(out <span class="op">&lt;</span><span class="st"> </span><span class="fl">1e-10</span>) <span class="op">|</span><span class="st"> </span>(<span class="op">!</span><span class="kw">is.finite</span>(out))
    out[bad] &lt;-<span class="st"> </span><span class="fl">1e-10</span>
    out &lt;-<span class="st"> </span><span class="kw">sum</span>(<span class="kw">log</span>(out))
  }
  out</code></pre></td>
</tr></table></div>
<p>Once you’ve setup your parameters, priors and your log likelihood function, the next step is to initialise the <code>sampler</code> object.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">sampler</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/psamplers/man/pmwgs.html">pmwgs</a></span>(
  <span class="kw">data</span> <span class="kw">=</span> <span class="no">forstmann</span>,
  <span class="kw">pars</span> <span class="kw">=</span> <span class="no">pars</span>,
  <span class="kw">prior</span> <span class="kw">=</span> <span class="no">priors</span>,
  <span class="kw">ll_func</span> <span class="kw">=</span> <span class="no">lba_loglike</span>
)</pre></body></html></div>
<p>The <code>pmwgs</code> function takes a set of arguments (listed below) and returns a list containing the required components for performing the particle metropolis within Gibbs steps.</p>
<ul>
<li>
<code>data =</code> your data - a data frame (e.g.<code>forstmann</code>) with a column for participants called <b><code>subject</code></b>
</li>
<li>
<code>pars =</code> the model parameters to be used (e.g.<code>pars</code>)</li>
<li>
<code>prior =</code> the priors to be used (e.g.<code>priors</code>)</li>
<li>
<code>ll_func =</code> name of log likelihood function you’ve sourced above (e.g.<code>lba_loglike</code>)</li>
</ul>
<div id="start-points" class="section level3">
<h3 class="hasAnchor">
<a href="#start-points" class="anchor"></a>Model start points</h3>
<p>You have the option to set model start points. We have specified sensible start points for the Forstmann dataset. If you chose not to specify start points, the sampler will randomly sample points from the prior distribution.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">start_points</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(
  <span class="kw">mu</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">.2</span>, <span class="fl">.2</span>, <span class="fl">.2</span>, <span class="fl">.4</span>, <span class="fl">.3</span>, <span class="fl">1.3</span>, -<span class="fl">2</span>),
  <span class="kw">sig2</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/diag.html">diag</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/rep.html">rep</a></span>(<span class="fl">.01</span>, <span class="fu"><a href="https://rdrr.io/r/base/length.html">length</a></span>(<span class="no">pars</span>)))
)</pre></body></html></div>
<p>The <code>start_points</code> object contains two vectors:</p>
<ul>
<li>
<code>mu</code> a vector of start points for the mu of each model parameter</li>
<li>
<code>sig2</code> vector containing the start points of the covariance matrix of covariance between model parameters.</li>
</ul>
</div>
<div id="run-sampler" class="section level3">
<h3 class="hasAnchor">
<a href="#run-sampler" class="anchor"></a>Running the sampler</h3>
<p>Okay - now we are ready to run the sampler.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">sampler</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/psamplers/man/init.html">init</a></span>(<span class="no">sampler</span>, <span class="kw">theta_mu</span> <span class="kw">=</span> <span class="no">start_points</span>$<span class="no">mu</span>,
                <span class="kw">theta_sig</span> <span class="kw">=</span> <span class="no">start_points</span>$<span class="no">sig2</span>)</pre></body></html></div>
<p>Here we are using the <code>init</code> function to generate initial start points for the random effects and storing them in the <code>sampler</code> object. First we pass the <code>sampler</code> object from above that includes our data, parameters, priors and log likelihood function. If we decided to specify our own start points (as above), we would include the <code>theta_mu</code> and <code>theta_sig</code> arguments.</p>
<p>Now we can run the sampler using the <code>run_stage</code> function. The <code>run_stage</code> function takes four arguments:</p>
<ul>
<li>
<code>x</code> the <code>sampler</code> object including parameters</li>
<li>
<code>stage =</code> the sampling stage (e.g. <code>"burn"</code>, <code>"adapt"</code> or <code>"sample"</code>)</li>
<li>
<code>iter =</code> is the number of iterations for the sampling stage</li>
<li>
<code>particles =</code> is the number of particles generated on each iteration</li>
</ul>
<p>It is optional to include the <code>iter =</code> and <code>particles =</code> arguments. If these are not included, <code>iter</code> and <code>particles</code> default to 1000. The number of iterations you choose for your burn in stage is similar to choices made when running deMCMC, however, this varies depending on the time the model takes to reach the ‘real’ posterior space.</p>
<p>First we run our burn in stage by setting <code>stage =</code> to <code>"burn"</code>. Here we have set iterations to be 500, which may take some time.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">burned</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/psamplers/man/run_stage.html">run_stage</a></span>(<span class="no">sampler</span>, <span class="kw">stage</span> <span class="kw">=</span> <span class="st">"burn"</span>, <span class="kw">iter</span> <span class="kw">=</span> <span class="fl">500</span>, <span class="kw">particles</span> <span class="kw">=</span> <span class="fl">1000</span>)</pre></body></html></div>
<p>Now we run our adaptation stage by setting <code>stage = "adapt"</code> Because we have not specified number of iterations or particles, the sampler will use the default value of 1000 for each of these arguments. N.B. The sampler will quit adaptation stage after 20 unique values have been accepted for each subject. This means adaptation may not use all 1000 iterations.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">adapted</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/psamplers/man/run_stage.html">run_stage</a></span>(<span class="no">burned</span>, <span class="kw">stage</span> <span class="kw">=</span> <span class="st">"adapt"</span>)</pre></body></html></div>
<p>At the start of the <code>sampled</code> stage, the sampler object will create a ‘proposal’ distribution for each subject’s random effects using a conditional multi-variate normal. This proposal distribution is then used to efficiently generate new particles for each subject which means we can reduce the number of particles on each iteration whilst still achieving acceptance rates.</p>
<div class="sourceCode"><html><body><pre class="r"><span class="no">sampled</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/psamplers/man/run_stage.html">run_stage</a></span>(<span class="no">adapted</span>, <span class="kw">stage</span> <span class="kw">=</span> <span class="st">"sample"</span>, <span class="kw">iter</span> <span class="kw">=</span> <span class="fl">100</span>, <span class="kw">particles</span> <span class="kw">=</span> <span class="fl">100</span>)</pre></body></html></div>
</div>
</div>
</div>
<div id="references" class="section level1 unnumbered">
<h1 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h1>
<div id="refs" class="references">
<div id="ref-brown2008simplest">
<p>Brown, Scott, and Andrew Heathcote. 2008. “The Simplest Complete Model of Choice Response Time: Linear Ballistic Accumulation.” <em>Cognitive Psychology</em> 57 (3). Elsevier: 153–78.</p>
</div>
<div id="ref-forstmann2008striatum">
<p>Forstmann, Birte U, Gilles Dutilh, Scott Brown, Jane Neumann, D Yves Von Cramon, K Richard Ridderinkhof, and Eric-Jan Wagenmakers. 2008. “Striatum and Pre-Sma Facilitate Decision-Making Under Time Pressure.” <em>Proceedings of the National Academy of Sciences</em> 105 (45). National Acad Sciences: 17538–42.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Gavin Cooper.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
